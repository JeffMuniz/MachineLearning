{
   "name": "conn-in-recebimento-efetivacao",
   "config": {
		   "version" : 2,
		   "description" : "Conector de entrada de dados de recebimentos efetivados",
		   "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",
           "connection.url": "jdbc:sqlserver://{{ENV_DB_HOST}}:{{ENV_DB_PORT}};databaseName={{ENV_DB_BLUE_NAME}}",
           "connection.user": "{{ENV_DB_USER}}",
		   "connection.passingthroughportalword": "{{ENV_DB_passingthroughportalword}}",
		   "topic.prefix": "topic-conn-conf-recebimento-efetivacao",
		   "poll.interval.ms": 60000,
		   "mode": "incrementing",
		   "incrementing.column.name": "idRecebimento",
		   "incrementing.offset": "0",
		   "validate.non.null": true,
		   "query": "SELECT * FROM (SELECT EP.Id_EventoPagamento AS idRecebimento, CAST((sum(ECDP.Valor) - (ISNULL(BE.ValorDesconto, 0) + ISNULL(BE.ValorRebate, 0))) AS NUMERIC(15,2)) AS valor, EP.DataEntradaPagamento AS dataEfetivacao, BE.Id_Boleto AS idAgendamento FROM ArquivoCargaSTD ARQ (nolock) INNER JOIN CargasCredito CB (nolock) on ARQ.Id_ArquivoCargaSTD = CB.Id_ArquivoCargaSTD INNER JOIN CargaControleFinanceiro CCF (nolock) on CB.Id_CargaControleFinanceiro = CCF.Id_CargaControleFinanceiro INNER JOIN BoletosEmitidos BE (nolock) on CCF.Id_Boleto = BE.Id_Boleto INNER JOIN  EventosExternosPagamentos EP (nolock) on BE.Id_EventoPagamento = EP.Id_EventoPagamento INNER JOIN EmpresasCargas EC (nolock) on CB.Id_CargaMacEdueficio = EC.Id_CargaMacEdueficio INNER JOIN EmpresasCargasDetalhes ECD (nolock) on EC.Id_EmpresaCarga = ECD.Id_EmpresaCarga INNER JOIN EmpresasCargasDetalhesProdutos ECDP (nolock) on ECD.Id_EmpresaCargaDetalhe = ECDP.Id_EmpresaCargaDetalhe WHERE ECDP.Status NOT IN (2, 4, 5) AND CB.Status not in (6) GROUP BY EP.DataEntradaPagamento, EP.Id_EventoPagamento, BE.Id_Boleto, BE.ValorDesconto, BE.ValorRebate ) AS RecebimentoEfetivacaoPagamento",
		   "key.converter.schema.registry.url" : "https://{{ENV_API_SCHEMA_REGISTRY_URL}}",
           "value.converter.schema.registry.url" : "https://{{ENV_API_SCHEMA_REGISTRY_URL}}",
           "value.converter.schema.registry.basic.auth.user.info": "{{ENV_API_SCHEMA_REGISTRY_KEY}}:{{ENV_API_SCHEMA_REGISTRY_SECRET}}",
           "key.converter.schema.registry.basic.auth.user.info": "{{ENV_API_SCHEMA_REGISTRY_KEY}}:{{ENV_API_SCHEMA_REGISTRY_SECRET}}",
		   "auto.register.schemas":"true",
		   "transforms":"createKey,extractInt,setSchemaName",
		   "transforms.createKey.type":"org.apache.kafka.connect.transforms.ValueToKey",
		   "transforms.createKey.fields":"idRecebimento",
		   "transforms.extractInt.type":"org.apache.kafka.connect.transforms.ExtractField$Key",
		   "transforms.extractInt.field":"idRecebimento",
		   "transforms.setSchemaName.type":"org.apache.kafka.connect.transforms.SetSchemaMetadata$Value",
		   "transforms.setSchemaName.schema.name":"br.com.mac-edu.schema.ConnConfirmacaoRecebimentoEfetivacaoValue",
		   "key.converter":"io.confluent.connect.avro.AvroConverter",
		   "value.converter":"io.confluent.connect.avro.AvroConverter",
		   "key.converter.basic.auth.credentials.source": "USER_INFO", 
    	   "value.converter.basic.auth.credentials.source": "USER_INFO"
	}
}